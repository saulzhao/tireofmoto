---
import BaseLayout from "../../layouts/BaseLayout.astro";

const modules = import.meta.glob("../../content/posts/*.md", { eager: true });

const tagCount = new Map();
for (const mod of Object.values(modules)) {
  const tags = (mod.frontmatter?.tags ?? []).map(String);
  for (const t of tags) tagCount.set(t, (tagCount.get(t) ?? 0) + 1);
}

const tags = [...tagCount.entries()]
  .map(([tag, count]) => ({ tag, count }))
  .sort((a, b) => b.count - a.count || a.tag.localeCompare(b.tag));
---

<BaseLayout title="Tags" description="Browse posts by tag">
  <section class="hero">
    <h1>Tags</h1>
    <p class="meta">If you can see this text, the route is working.</p>
  </section>

  <section class="grid">
    {tags.map((t) => (
      <a class="card" style="grid-column: span 4" href={`/tags/${encodeURIComponent(t.tag)}`}>
        <h2 style="margin:0 0 6px">#{t.tag}</h2>
        <p class="meta" style="margin:0">{t.count} post(s)</p>
      </a>
    ))}
  </section>
</BaseLayout>
